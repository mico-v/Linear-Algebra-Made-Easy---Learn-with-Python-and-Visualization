name: Build PDF Book

on:
  workflow_dispatch:
    inputs:
      build_type:
        description: 'Which book(s) to build'
        required: true
        default: 'all'
        type: choice
        options:
          - all
          - upper
          - lower
          - full

jobs:
  build-pdf:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install PyPDF2
      
      - name: Build PDF books
        run: python merge_book.py
      
      - name: Display build results
        run: |
          echo "=== Build Results ==="
          ls -lh merged_books/
          echo ""
          echo "=== Page counts ==="
          python -c "
          from PyPDF2 import PdfReader
          import os
          for f in sorted(os.listdir('merged_books')):
              path = os.path.join('merged_books', f)
              r = PdfReader(path)
              size = os.path.getsize(path) / (1024*1024)
              print(f'{f}: {len(r.pages)} pages, {size:.1f} MB')
          "
      
      - name: Upload PDF artifacts
        uses: actions/upload-artifact@v4
        with:
          name: linear-algebra-books
          path: merged_books/*.pdf
          retention-days: 30
